### 关系数据库标准语言SQL

#### 3.1 概述

#### 3.2 xxx

#### 3.3 数据定义

##### 3.3.1 模式的定义与删除

```sql
//定义模式：必须拥有相应权限才能定义模式，不指定模式名则默认为用户名
CREATE SCHEMA <模式名> AUTHORIZATION <用户名>;


//删除模式：cascade(级联,删除模式同时删除其中中所有对象)、restrict(限制，模式存在下属对象时不执行删除模式的操作)
DROP SCHEMA <模式名> <CASCADE|RESTRICT>;

//可以在定义模式的同时，进一步定义该模式包含的数据库对象（表、视图、索引等）
```

##### 3.3.2 基本表的定义、删除与修改

```sql
//创建表
CREATE TABLE <表名> (
    <列名1> <数据类型> [列级完整性约束条件],
    ...,
    <列名n> <数据类型> [列级完整性约束条件],
    [标记完整性约束条件]         
)

//删除表
DROP TABLE <表名> [RESTRICT|CASCADE]

//修改表
ALTER TABlE <表名>
//添加列
ADD [COLUMN] <新列名> <数据类型> [完整性约束]
//删除列
DROP [COLUMN] <列名> [CASCADE|RESTRICT]
//修改列（每个数据库不一样）
ALTER COLUMN <列名> <数据类型>
//添加表级完整性约束
ADD <表级完整性约束>
//删除完整性约束
DROP CONSTRAINT <完整性约束名> [RESTRICT|CASCADE]
```

- 列级完整性约束条件

  主键：PRIMARY KEY  

  非空：NOT NULL    

  唯一值：UNIQUE    

- 表级完整性约束条件

  外键：FOREIGN KEY ( 列名 )  REFERENCES 被参照表名 ( 被参照列名 )      注：可以参照本表。    

  主键：PRIMARY KEY ( 列名1, 列名2 , ... )    注：当主键由多个属性构成时必须使用表级完整性约束。  

- 数据类型

  | 数据类型                             | 含义                |
  |:--------------------------------:|:-----------------:|
  | CHAR(n) , CHARACTER(n)           | 长度为n的定长字符串        |
  | VARCHAR(n) , CHARACTERVARYING(n) | 最大长度为n的变长字符串      |
  | CLOB                             | 字符串大对象            |
  | BLOB                             | 二进制大对象            |
  | INT , INTEGER                    | 长整数（4字节）          |
  | SMALLINT                         | 短整数（2字节）          |
  | BIGINT                           | 大整数               |
  | NUMERIC( p,d )                   | 定点数(p位数字，d位小数)    |
  | DECIMAL( p,d ) , DEC( p,d )      | 同上                |
  | REAL                             | 取决于机器精度的单精度浮点数    |
  | DOUBLE PRECISION                 | 取决于机器精度的双精度浮点数    |
  | FLOAT( n )                       | 精度至少为n位数字的浮点数     |
  | BOOLEAN                          | 逻辑布尔量             |
  | DATE                             | 日期（格式为YYYY-MM-DD） |
  | TIME                             | 时间（格式为HH:MM:SS）   |
  | TIMESTAMP                        | 时间戳类型             |
  | INTERVAL                         | 时间间隔类型            |

#### 3.4 数据查询

```
//一般格式
SELECT [DISTINCT] <目标列表达式> [AS] [别名], ... 
FROM <表名、视图名或(<SELECT 语句>) [AS] <别名>>, ...
[WHERE <条件表达式>]
[GROUP BY <列名>] [HAVING <条件表达式>]
[ORDER BY <列名>] [ASC升序，默认|DESC降序]
```

- 目标列表达式可以是：属性列、表达式、字符串常量、函数等。
- 常用查询条件：   

| 查询条件       | 谓词                               |
| ---------- | -------------------------------- |
| 比较         | =，>，<，>=，<=，!=，<>，!>，!<;NOT+以上符号 |
| 确定范围       | BETWEEN AND，NOT BETWEEN AND      |
| 确定集合       | IN， NOT IN                       |
| 字符匹配       | LIKE， NOT LIKE                   |
| 空值         | IS NULL， IS NOT NULL             |
| 多重条件（逻辑运算） | AND， OR， NOT                     |

- 字符匹配（模糊查询）：  

  通配符：%（任意长度字符串）、_（任意单个字符）  

  换码字符：ESCAPE '\' 表示\为换码字符，则匹配串中\后面的为普通字符  

  字符集：通常ASCII中一个汉字要两个_表示,GBK中要一个  

  ```sql
  [NOT] LIKE '<匹配串>' [ESCAPE '<换码字符>']
  ```
- 聚集函数

| 函数                           | 作用                 |
| ---------------------------- | ------------------ |
| COUNT(*)                     | 统计元组个数             |
| COUNT([ALL默认/DISTINCT] <列名>) | 统计一列中值的个数          |
| SUM([ALL默认/DISTINCT] <列名>)   | 计算一列（必须为数值类型）值的总和  |
| AVG([ALL默认/DISTINCT] <列名>)   | 计算一列（必须为数值类型）值的平均值 |
| MAX([ALL默认/DISTINCT] <列名>)   | 一列中最大值             |
| MIN([ALL默认/DISTINCT] <列名>)   | 一列中最小值             |

聚集函数除了COUNT(*)之外，都跳过空值不做统计；  
聚集函数只能用于SELECT子句和GROUP BY中的HAVING子句。  

##### 连接查询：

- 等值连接与非等值连接
- 自然连接
- 自身连接
- 外连接、左外连接、右外连接

##### 嵌套查询

查询块：SELECT-FROM-WHERE  
嵌套查询：一个查询块嵌套在另一个查询块的WHERE子句或HAVING短语的条件中  
不相关子查询：  
相关子查询：   
OREDER BY不能使用在子查询中，它只能对最中的结果排序。  
相比于连接查询，目前商用关系数据库管理系统对嵌套查询的优化做得还不够完善，所以在实际应用中，能够用连接运算表达的尽可能采用连接运算。
ANY(SOME)和ALL谓词子查询：  
EXISTS谓词子查询：  

##### 集合查询

并：UNION  
交：INTERSECT  
差：EXCEPT  

##### 派生表

#### 3.5 数据更新

##### 3.5.1 插入数据

```sql
//插入元组
INSERT INTO <表名> [(属性列1), ...]
VALUES(<常量1>, ...)

//插入子查询结果
INSERT INTO <表名> [(属性列1), ...]
子查询
```

字符串常量用单引号括起来  
所有列都有指定值时可以省略属性列，但列的次序要相对应  

##### 3.5.2 修改数据

```
UPDATE <表名> SET <列名>=<表达式>, ...
[WHERE <条件>]
```

##### 3.5.3 删除数据

```
DELETE FROM <表名>
[WHERE <条件>]
```

#### 3.6 空值处理

产生：  
判断：  
约束条件：  
加了UNIQUE不能取空值  
运算：  
