```java
@Slf4j
@Aspect
@Component
public class VagueResolver {

    @Pointcut("@annotation(com.jusekj.merchant.web.privacyhandler.annotion.EnablePrivacy)")
    public void serviceStatistics() {
    }

    @AfterReturning(value = "serviceStatistics()", returning = "returnValue")
    public void privacyHandler(JoinPoint point, Object returnValue) {
        try {
            Signature signature = point.getSignature();
            MethodSignature methodSignature = (MethodSignature) signature;
            Method targetMethod = methodSignature.getMethod();
            EnablePrivacy annotation = targetMethod.getAnnotation(EnablePrivacy.class);
            Class<? extends Strategy> strategy = annotation.strategy();
            if (!strategy.getName().equals(Strategy.class.getName())) {// 自定义了开启策略，根据策略判断是否开启模糊处理
                Strategy strategyObj = strategy.newInstance();
                Method enablePrivacy = strategy.getMethod("enablePrivacy");
                Boolean invoke = (Boolean) enablePrivacy.invoke(strategyObj);
                if (!invoke) {// 根据自定义策略，当前情况不进行模糊处理
                    return;
                }
            }

            log.info("----数据隐私字段模糊处理开始----");
            if (returnValue instanceof Page) { // 返回结果为分页
                List<?> list = ((Page<?>) returnValue).getRecords();
                for (Object obj : list) {
                    this.handPojo(obj);
                }
            } else if (returnValue instanceof List) { // 返回结果为List
                List<?> list = (List<?>) returnValue;
                for (Object obj : list) {
                    this.handPojo(obj);
                }
            } else if (returnValue.getClass().getTypeName().startsWith("com.jusekj.merchant.web")) { // 返回结果为pojo对象
                this.handPojo(returnValue);
            }
            log.info("----数据隐私字段模糊处理结束----");
        } catch (Exception e) {
            log.error(e.getMessage());
        }
    }

    public void handPojo(Object object) throws Exception {

        if (object == null) {
            return;
        }
        Class<?> clz = object.getClass();

        for (Field field : clz.getDeclaredFields()) {
            String fieldTypeName = field.getType().getTypeName();
            boolean annotationPresent = field.isAnnotationPresent(Vague.class);

            if (annotationPresent && fieldTypeName.equals("java.lang.String")) {// 属性上标注了注解，且为 String 类型，则进行模糊化处理（模糊化处理只能处理 String）
                Vague vague = field.getAnnotation(Vague.class);
                field.setAccessible(true);// 设置操作权限为true
                Method getMethod = clz.getMethod("get" + captureName(field.getName()));
                Object oldValue = getMethod.invoke(object);// 原字段值
                Method setMethod = clz.getMethod("set" + captureName(field.getName()), field.getType());
                Object newValue = this.handleValue(oldValue, vague.type());// 进行字段隐私处理
                setMethod.invoke(object, newValue);
            } else if (fieldTypeName.equals("java.util.List")) { // 嵌套 List 字段
                field.setAccessible(true);// 设置操作权限为true
                Method getMethod = clz.getMethod("get" + captureName(field.getName()));
                List<?> fieldObj = (List<?>) getMethod.invoke(object);// 原字段值
                for (Object obj : fieldObj) {
                    this.handPojo(obj);
                }
            } else if (fieldTypeName.startsWith("com.jusekj.merchant.web")) { //嵌套 pojo
                field.setAccessible(true);// 设置操作权限为true
                Method getMethod = clz.getMethod("get" + captureName(field.getName()));
                Object fieldObj = getMethod.invoke(object);// 原字段值
                this.handPojo(fieldObj);
            }
        }

    }

    public Object handleValue(Object object, PrivacyType type) {
        Coverage coverage = new Coverage();
        switch (type) {
            case NAME:
            case ADDRESS:
                return coverage.handleNAME(object);
            case ID_CODE:
                return coverage.handleIDCODE(object);
            case PHONE_NO:
                return coverage.handlePHONE_NO(object);
            case BANK_CODE:
                return coverage.handleBANK_CODE(object);
        }
        return object;
    }


    /**
     * 字符转成大写
     *
     * @return
     */
    public String captureName(String name) {
        char[] cs = name.toCharArray();
        cs[0] -= 32;
        return String.valueOf(cs);
    }

}
```

