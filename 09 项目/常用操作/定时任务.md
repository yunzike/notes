## 1、定时任务

### 1.1 Timer





### 1.2 ScheduledExecutorService





### 1.3 Spring Task

使用 Spring 或者 Spring Boot 框架时

#### 步骤

1、开启定时任务

在 Spring Boot 的启动类上声明 @EnableScheduling 即可

2、添加定时任务

使用 @Scheduled 注解标注



#### Cron 表达式

cron 表达式来声明执行的频率和规则，cron 表达式是由 6 位或者 7 位组成的（最后一位可以省略），每位之间以空格分隔，每位从左到右代表的含义如下：

| 字段                     | 允许值                         | 允许的符号 |
| ------------------------ | ------------------------------ | ---------- |
| 秒（Seconds）            | 0~59的整数                     |            |
| 分（Minutes）            | 0~59的整数                     |            |
| 小时（Hours）            | 0~23的整数                     |            |
| 日期（DayofMonth）       | 1~31的整数                     |            |
| 月份（Month）            | 1~12 的整数或者 JAN-DEC        |            |
| 星期（DayofWeek）        | 1~7的整数或者 SUN-SAT（1=SUN） |            |
| 年（可选，留空）（Year） | 1970~2099                      |            |











### 1.4 Redis ZSet 实现定时任务



#### 键空间通知







### 1.5 xxl - job





## 2、延时任务

> 应用场景
>
> a. 外卖订单超过15分钟未支付，自动取消
> b. 使用抢票软件订到车票后，1小时内未支付，自动取消
> c. 待处理申请超时1天，通知审核人员经理，超时2天通知审核人员总监
> d. 客户预定自如房子后，24小时内未支付，房源自动释放 

那么针对这类场景的需求应该如果实现呢，我们最先想到的一般是启个定时任务，来扫描数据库里符合条件的数据，并对其进行更新操作。一般来说spring-quartz 、elasticjob 就可以实现，甚至自己写个 Timer 也可以。

但是这种方式有个弊端，就是需要不停的扫描数据库，如果数据量比较大，并且任务执行间隔时间比较短，对数据库会有一定的压力。另外定时任务的执行间隔时间的粒度也不太好设置，设置长会影响时效性，设置太短又会增加服务压力。我们来看一下有没有更好的实现方式。

[实现延时任务的 4 种实现方案！_Java技术栈，分享最主流的Java技术-CSDN博客](https://blog.csdn.net/youanyyou/article/details/108211662)

[Java延时任务方案 (juejin.cn)](https://juejin.cn/post/6844904121787482119#heading-20)

### 2.1 JDK 延时队列实现





### 2.2  时间轮算法





### 2.3 Redis ZSet 实现





### 2.4 MQ 延时队列实现

